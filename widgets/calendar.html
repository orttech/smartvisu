/**
* -----------------------------------------------------------------------------
* @package     smartVISU
* @author      Martin Glei√ü
* @copyright   2012 - 2015
* @license     GPL [http://www.gnu.de]
* -----------------------------------------------------------------------------
*/


/**
* Displays a calendarlist
*
* @param unique id for this widget (optional)
* @param a title to display (optional)
* @param the number of displayed calendar entries (optional, default 25)
* @param one color for all or a list of colors for each calendar (optional, grey or as defined in configuration)
* @param the refresh interval for this widget (optional, default 1h)
* @param name of calendars to show, multiples in array form (optional, default: as defined in configuration)
*
* @see misc/fundamentals#Array-Form
* @see misc/fundamentals#Duration-Format
*/
{% macro list(id, title, count, color, repeat, calendar) %}

	/** handle default colors from config */
	{% set configcolors = config_calendar_color|split(',') %}
	{% set confignames = config_calendar_name|split(',') %}

	{% if color is empty %}
		/** build associative array of calendar name and according color */
    {% set calendarcolors = [] %}
		{% for configname in confignames %}
			{% set calendarcolors = calendarcolors|merge({ (configname|trim|lower): configcolors[loop.index0]|trim }) %}
		{% endfor %}
		/** find color for calendars */
		{% set calendar = calendar|default(confignames) %}
    {% set color = [] %}
		{% for calendarname in (calendar is iterable ? calendar : [calendar]) %}
			{% set color = color|merge([calendarcolors[calendarname|trim|lower]|default('#666666')]) %}
		{% endfor %}
	{% endif %}

	<div {{ not id is empty ? 'id="' ~ uid(page, id) ~ '"' | raw }} data-widget="calendar.list" class="calendarlist"
		data-service="{{ config_calendar_service }}"
		data-repeat="{{ repeat|default('1h') }}" data-count={{ count|default(25) }}
		data-color="{{ implode(color) }}" data-calendar="{{ implode(calendar|default(confignames)) }}">
		{% if title %} <h2>{{ title }}</h2> {% endif %}
		<ul data-role="listview"></ul>
	</div>

{% endmacro %}

