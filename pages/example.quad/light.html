/**
 * -----------------------------------------------------------------------------
 * @package     smartVISU
 * @author      Onkel Andy
 * @copyright   2020
 * @license     GPL [http://www.gnu.de]
 * -----------------------------------------------------------------------------
 */


{% extends "quad_root.html" %}

{% block title %}
Light
{% endblock %}

{% block header %}
<img class="icon" src='{{ icon0 }}light_light.svg'/>

{% endblock %}

{% block content %}
<script>
$( document ).ready(function() {
			io.write('light.dimmen', '10' );
			io.write('light.SA', '1' );
		 	io.write('led.R.dimmen', '10' );
			io.write('led.R', '1' );
			io.write('led.G.dimmen', '100' );
			io.write('led.G', '1' );
			io.write('led.B.dimmen', '0' );
			io.write('led.B', '0' );
			io.write('led.WW.dimmen', '255' );
			io.write('led.WW', '1' );
			io.write('h.value', '50' );
			io.write('h.switch', '1' );
			io.write('s.value', '250' );
			io.write('s.switch', '1' );
			io.write('v.value', '250' );
			io.write('v.switch', '1' );
			io.write('led.sequencer', '0' );
      io.write('item1.automatik.stateengine_name', 'Standard');
		  io.write('item1.automatik.lock', '0');
      io.write('bwm.sperren', '1');
      io.write('light.zwangvalue', '1');
	});

</script>
{% set stateengine = {} %}
{% set stateengine_items = {
'item_1': ['item1.automatik.lock', 'item1.automatik.settings.suspendduration', '0', '60', '5', 'item1.automatik.settings.sollwert', '0', '250', '5', 'item1.automatik.settings.prio', '0', '1', 'sperren', 'stateengine', 'standard', 'morning'],
'item_2': ['item2.automatik.lock', 'item2.automatik.settings.suspendduration', '0', '60', '5', '', '', '', '', 'item2.automatik.settings.sperren', '0', '1', 'sperren', 'stateengine', 'standard', 'morning']
} %}

{% for item,content in stateengine_items %}
  {% set itemname = item|replace({'.': '_'}) %}
	{% set suspend = [['switch', 'slider'], [content[0], 'icon', [0,1], ['secur_open.svg','secur_locked.svg']], [content[1], content[2], content[3], content[4], '', 'handle']] %}
	{% set sollwerte = {} %}
	    {% set sollwerte = sollwerte|merge({'standard': content[5]~'.standard'}) %}
	    {% set sollwerte = sollwerte|merge({'morning': content[5]~'.morning'}) %}
	{% set sperrwerte = {} %}
	    {% set sperrwerte = sperrwerte|merge({'standard': content[9]~'.standard'}) %}
	    {% set sperrwerte = sperrwerte|merge({'morning': content[9]~'.morning'}) %}
	{% if 'standard' in content %}
	    {% set standard = [
        ['switch',
        (content[8] == '0') ? 'flip' : (content[8] != '') ? 'slider',
        (content[12] == 'sperren') ? 'switch',
        (content[12] == 'prio') ? 'select'],
        ['item1.automatik.settings.standard.active', 'icon', [0,1], ['time_automatic.svg','time_automatic.svg']],
        (content[8] == '0') ? [(sollwerte.standard), '', '', content[6], content[7]] : (content[8] != '') ? [(sollwerte.standard), content[6], content[7], content[8], '', 'handle'],
        (content[12] == 'sperren') ? [(sperrwerte.standard), 'icon', [content[10]|default(0),content[11]|default(1)], ['secur_open.svg','secur_locked.svg']],
        (content[12] == 'prio') ? [(sperrwerte.standard), 'icon', [0,2,3], ['control_minus.svg','light_light_dim_00.svg','light_light_dim_90.svg']]
        ] %}
	{% endif %}
	{% if 'morning' in content %}
  {% set morning = [
    ['switch',
    (content[8] == '0') ? 'flip' : (content[8] != '') ? 'slider',
    (content[12] == 'sperren') ? 'switch',
    (content[12] == 'prio') ? 'select'],
    ['item1.automatik.settings.morning.active', 'icon', [0,1], ['weather_sunrise.svg','weather_sunrise.svg']],
    (content[8] == '0') ? [(sollwerte.morning), '', '', content[6], content[7]] : [(sollwerte.morning), content[6], content[7], content[8], '', 'handle'],
    (content[12] == 'sperren') ? [(sperrwerte.morning), 'icon', [content[10]|default(0),content[11]|default(1)], ['secur_open.svg','secur_locked.svg']],
    (content[12] == 'prio') ? [(sperrwerte.morning), 'icon', [0,2,3], ['control_minus.svg','light_light_dim_00.svg','light_light_dim_90.svg']]
    ] %}
	{% endif %}


	{% set suspendtext = ['header', 'Suspendzeit'] %}
	{% if content[12] == 'sperren' and content[8] == '' %}
	    {% set sollwerttext = ['header', 'Sperrwerte'] %}
	{% elseif content[12] == 'prio' and not content[8] == '' %}
	    {% set sollwerttext = ['header', 'Soll- und Priowerte'] %}
  {% elseif content[12] == 'sperren' and not content[8] == '' %}
	    {% set sollwerttext = ['header', 'Soll- und Sperrwerte'] %}
	{% elseif content[12] == 'prio' and (content[8] == '' or content[8] == '0')%}
	    {% set sollwerttext = ['header', 'Priowerte'] %}
	{% else %}
	    {% set sollwerttext = ['header', 'Sollwerte'] %}
	{% endif %}
  {% set halloweendate = 'now'|date('m/d') == '10/31' %}
  {% set advent1 = 'now'|date('m/d') > '12/01' and 'now'|date('m/d') < '12/31' %}
  {% set advent2 = 'now'|date('m/d') > '01/01' and 'now'|date('m/d') < '01/15' %}

  {% set stateengine = stateengine|merge(
    {itemname: ['stateengine', suspendtext, suspend, sollwerttext, 'standard' in content ? standard, 'morning' in content ? morning,  'halloween' in content and halloweendate ? halloween, 'advent' in content and advent1 or advent2 ? advent]}
    ) %}
{% endfor %}

<ul data-role="listview" data-dividertheme="c" class="quad_list">
    <li data-role="list-divider">Dimmer</li>

    ['uzsu', 'stateengine', 'plot', 'value_popup', 'switch', 'locks', ' '] stateengine with popup
	{{ quad.dimmer('dimmer1', 'Dimmer Example 1', 'light.SA', 'light.dimmen', 0, 255, 1, icon.light('','','light.dimmen'), icon.light(), 'icon1', 'icon0', '', '', '', '', 'blink', '', 'light.dimmen.zeitschalter', '', '%', 'light.dimmen', '', 'item1.automatik', (stateengine['item_1']), ['', 'bwm.sperren', 'light.zwangvalue'], '', '', ['uzsu', 'stateengine', 'plot', 'value_popup', 'switch', 'locks', ' ']) }}

	[['locks','switch'], 'value_popup', 'extpopup', 'plot']
	{{ quad.dimmer('dimmer3', 'Dimmer Example 2', 'light.SA', 'light.dimmen', 0, 255, 1, icon.light('','','light.dimmen'), icon.light(), 'icon1', 'icon0', '', '', '', '', 'blink', '', 'light.dimmen.zeitschalter', '', '%', 'light.dimmen', '', 'light.automatik', ['edit_favorites.svg', ['switch', ['item1.lock', 'icon', [0,1], ['secur_open.svg','secur_locked.svg']]], ['flip', ['item1.flip', 'on', 'off', '0', '1']] ], ['', 'bwm.sperren', 'light.zwangvalue'],  '', '', [['locks','switch'], 'value_popup', 'extpopup', 'plot']) }}

	['switch', 'value_slider']
	{{ quad.dimmer('dimmer4', 'Dimmer Example 3', 'light.SA', 'light.dimmen', 0, 255, 1, icon.light('','','light.dimmen'), icon.light(), '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ['switch', 'value_slider']) }}

	no column_order
	{{ quad.dimmer('dimmer2', 'Standard Example 1', 'light.SA', 'light.dimmen', 0, 255, 1, icon.light('','','light.dimmen'), icon.light()) }}

    <li data-role="list-divider">RGB Color</li>
    (id, item_value_r, item_value_g, item_value_b, min, max, step, colors, style, colormodel, linetext, item_switch_r, item_switch_g, item_switch_b, min_display, max_display, item_uzsu, uzsu_attribs, popupcolor, item_switch_ww, item_value_ww, item_plot, icon_plot, item_auto, extpopup, locks, item_seq, icon_color, place3, place4, column_order)

    [['locks','sequencer','colorpicker','ww_slider'], 'ww_popup','values']
    {{ quad.color('color1', 'led.R.dimmen', 'led.G.dimmen', 'led.B.dimmen', 0, 255, 10, 30, '', '', 'Disc, WW Slider, locks, WW popup, hsv popup', 'led.R', 'led.G', 'led.B', '', '', '', '', 'hsv', 'led.WW', 'led.WW.dimmen', '', '', '', '', ['', 'bwm.sperren', '', 'led.sequencer.sperren'], 'led.sequencer', '', '', '', [['locks','sequencer','colorpicker','ww_slider'], 'ww_popup','values']) }}

    [['locks','sequencer','colorpicker'], 'ww_slider','values']
    {{ quad.color('color2', 'led.R.dimmen', 'led.G.dimmen', 'led.B.dimmen', 0, 255, 10, 30, '', '', 'WW slider, rgb popup', 'led.R', 'led.G', 'led.B', '', '', '', '', 'rgb', 'led.WW', 'led.WW.dimmen', '', '', '', '', ['', 'bwm.sperren', '', 'led.sequencer.sperren'], 'led.sequencer', '', '', '', [['locks','sequencer','colorpicker'], 'ww_slider','values']) }}

    ['locks', 'colorpicker', 'values']
    {{ quad.color('color3', 'led.R.dimmen', 'led.G.dimmen', 'led.B.dimmen', 0, 255, 10, 30, 'slider', '', 'HSV slider, 3 columns', 'led.R', 'led.G', 'led.B', '', '', '', '', 'hsv', '', '', '', '', '', '', ['', 'bwm.sperren', '', ''], '', '', '', '', ['locks', 'colorpicker', 'values']) }}

    [['locks','colorpicker', 'ww_slider'], 'values']
    {{ quad.color('color4', 'led.R.dimmen', 'led.G.dimmen', 'led.B.dimmen', 0, 255, 10, 30, 'slider', '', 'HSV slider+WW, 3 columns', 'led.R', 'led.G', 'led.B', '', '', '', '', 'hsv', 'led.WW', 'led.WW.dimmen', '', '', '', '', ['', 'bwm.sperren', '', ''], '', '', '', '', [['locks','colorpicker', 'ww_slider'], 'values', 'stateengine', 'plot']) }}

    ['locks', 'colorpicker', 'values', 'plot']
    {{ quad.color('color5', 'led.R.dimmen', 'led.G.dimmen', 'led.B.dimmen', 0, 255, 10, 30, '', '', 'RGB Disc, separate columns', 'led.R', 'led.G', 'led.B', '', '', '', '', 'hsv', 'led.WW', 'led.WW.dimmen', 'led.WW', '', '', '', ['', 'bwm.sperren', '', 'led.sequencer.sperren'], 'led.sequencer', '', '', '', '', ['locks', 'colorpicker', 'values', 'plot']) }}

	['colorpicker', '20', '40', 'uzsu']
    {{ quad.color('color6', 'h.value', 's.value', 'v.value', 0, 255, 10, 30, '', '', 'HSV Modell, 2 empty cols', '', '', '', '', '', 'licht.dimmen.zeitschalter', ['time_clock', 'time_clock', 'num', '', 'icon1', 'icon0'], 'hsv', '', '', '', '', '', '', '', '', '', '', '', ['colorpicker', '20', '40', 'uzsu']) }}

  no column_order
    {{ quad.color('color7', 'led.R.dimmen', 'led.G.dimmen', 'led.B.dimmen', 0, 255, 10, 30, '', '', 'RGB Disc, bwm lock item, 2 cols', 'led.R', 'led.G', 'led.B', '', '', '', '', 'hsv', '', '', '', '', '', '', ['', 'bwm.sperren', '', '']) }}

</ul>

{% endblock %}
